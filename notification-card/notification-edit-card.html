<link rel="import" href="../../paper-card/paper-card.html">
<link rel="import" href="../../paper-toggle-button/paper-toggle-button.html">  
<link rel="import" href="../../paper-input/paper-input.html">  
<link rel="import" href="../../paper-slider/paper-slider.html">  
<link rel="import" href="../../iron-validatable-behavior/iron-validatable-behavior.html">
<link rel="import" href="../../paper-fab/paper-fab.html">
<link rel="import" href="../../iron-icon/iron-icon.html">
<link rel="import" href="../../iron-icons/iron-icons.html">
<link rel="import" href="../utility-el/sensitivity-selector.html">

<!--
just doesn't seem to work
<link rel="import" href="../../paper-dialog-scrollable/paper-dialog-scrollable.html">
-->


<link rel="import" href="./notification-time-edit-prep.html">

<dom-module id="notification-edit-card">
  <style>
      #closeButton{
        position:absolute;
        top: -30px;
        left: -50px;
      }
      paper-card:{
        overflow: auto;
      }
  </style>
  <template>
    <paper-card >
      <paper-fab id="closeButton" icon="close" on-tap="close"></paper-fab>

        <div class="card-content">
           <h2>{{soundInfo.name}}</h2>   
        </div>

        <div>
            <paper-toggle-button checked="{{soundInfo.repeatingNotification}}"> repeating notification</paper-toggle-button>
        </div>
        <div>
            <!--<priority-selector certainty="{{soundInfo.certainty}}"></priority-selector> -->
        </div>
        <div>
            <paper-toggle-button checked="{{soundInfo.timeNotification}}"> enable time specific notes</paper-toggle-button>
        </div>
        <div>
          
        </div>
        <div id="notificationTimeEditsContainer">
          <notification-time-edit-prep id="notificationTPrep" days="{{soundInfo.notificationDays}}"></notification-time-edit-prep>
        </div>
        <div>
          <sensitivity-selector sensitivity="{{soundInfo.sensitivity}}"></sensitivity-selector>
        </div>
        <paper-button on-tap="submit" raised> Submit </paper-button>
        <paper-button on-tap="delete" raised>delete</paper-button>
        <paper-button on-tap="test" raised>test</paper-button>

    </paper-card>
            
           
  </template>
  <script>
    Polymer({
        is: 'notification-edit-card',
        properties:{
          soundInfo:{
                type : Object,
                reflectToAttribute: true,
                value: function(){
                  return {
                    name: "default",
                    disabledNotification: false,
                    repeatingNotification: false,
                    timeNotification: false,
                    sensitivity: 0,
                    notificationDays:[{"day":"T",
                                       "start":"01:00",
                                        "end": "12:00"}]
                  }
                }
                
            },
        },
        observers:[
          '_closeOpenSpecificTimeSelector(soundInfo.timeNotification)'
        ],
        submit: function(){
          console.log("fired subitNotficationChange");
          console.log(this.$.notificationTPrep.notificationDaysArray);
          var nDayArray = this.$.notificationTPrep.notificationDaysArray;
            
          var days = ["M","T","W","Th","F","S", "SU"];
          var returnArray = {};
          for(var i =0; i < days.length; i++){
              if(nDayArray[i].start != "00:00" || nDayArray[i].end != "00:00"){
                  var asdf = days[i];
                  returnArray[days[i]] = nDayArray[i];
              }
          }

          console.log(days);
          this.soundInfo.notificationDays = returnArray;

          this.fire('submitNotification', {"soundInfo": this.soundInfo});
        },
        delete: function(){
          this.fire('deleteNotification');
        },
        close: function(){
          this.fire('closeNotificationEdit');
        },
        test: function(){
            console.log(this.soundInfo);
        },
        _closeOpenSpecificTimeSelector: function(switchValue){
          if(typeof switchValue != "undefined"){
            if(switchValue === true){
              this.$.notificationTimeEditsContainer.hidden = false;
            }
            else if(switchValue === false){
              this.$.notificationTimeEditsContainer.hidden = true;
            }
          }        
        },
        test: function(){
          console.log(this.soundInfo);
        }

        
        
    });
  </script>
</dom-module>