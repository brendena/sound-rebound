<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymerfire/firebase-auth.html">
<link rel="import" href="../polymerfire/firebase-document.html">
<link rel="import" href="../polymerfire/firebase-messaging.html">
<link rel="import" href="../paper-toggle-button/paper-toggle-button.html">
<dom-module id="my-subscription">
  <template>

  <firebase-auth
    user="{{user}}">

  </firebase-auth>


  <firebase-messaging 
    id="messaging"
    token="{{token}}"
    on-message="handleMessage">
  </firebase-messaging>

  <firebase-document 
    id="document"
    path="/notification/[[user.uid]]/token" 
    data="[[token]]">
  </firebase-document>

  <paper-toggle-button
    id="subscribe"
    on-tap="toggleSubscription"
    checked="[[token]]">
    subscribe to notifications
  </paper-toggle-button>

  <p on-tap="test">Token:</p>
  <p>[[token]]</p>

  

  </template>
  <script>
    Polymer({
      is: 'my-subscription',
      test: function(){
        this.$.document.data = "asdf";
      },
      toggleSubscription: function() {
        var requestPermission = this.$.subscribe.checked;
        if (requestPermission) {
          this.$.messaging.requestPermission().then(() => {
            console.log('user subscribed successfully!');
          }, (err) => {
            console.log('user subscribe failed :(', err);
          });
        } else {
          console.log('user rejected permission');
        }
      },
      handleMessage: function(){
        console.log('message recived', arguments);
      }
    });
  </script>
</dom-module>
